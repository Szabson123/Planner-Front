<!-- plan.component.html -->

<div class="month-navigation">
  <button (click)="previousMonth()">← Poprzedni miesiąc</button>
  <span class="current-month">{{ formatCurrentMonth() }}</span>
  <button (click)="nextMonth()">Następny miesiąc →</button>
</div>

<!-- Legenda Kolorów -->
<div class="shift-legend" *ngIf="shiftColorMap.size > 0">
  <h3>Legenda Zmian:</h3>
  <ul>
    <li *ngFor="let shift of shiftColorMap | keyvalue">
      <span [ngStyle]="{'background-color': shift.value}" class="legend-color"></span>
      {{ shift.key }}
    </li>
  </ul>
</div>

<div class="days-header" *ngIf="false">
  <div class="day" *ngFor="let day of daysInMonth">
    {{ day.date() }}
  </div>
</div>

<div class="calendar-grid" *ngIf="!isLoading && !errorMessage && !isUsersLoading">
  <table>
    <thead>
      <tr>
        <th class="user-column">Użytkownik</th>
        <th *ngFor="let day of daysInMonth" class="date-column">
          {{ day.format('DD') }}
        </th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let user of users">
        <td class="user-name">
          <p style="margin: 0;" class="name">{{ user.first_name | truncate:10 }}</p> 
          <p style="margin: 0;" class="name">{{ user.last_name | truncate:10 }}</p>
        </td>
        <td *ngFor="let day of daysInMonth" class="event-cell">
          <div *ngIf="schedule.get(user.id)?.get(day.format('YYYY-MM-DD')) as events">
            <div *ngFor="let event of events" 
                 [ngClass]="getEventClass(event.type)" 
                 class="event-content"
                 [ngStyle]="{'background-color': event.type === 'event' ? shiftColorMap.get(primaryShiftMap.get(user.id) || '') : ''}">
              <span *ngIf="event.type === 'event'" 
                    class="tooltip" 
                    [attr.data-title]="user.first_name + '\n'  + user.last_name + '\nZmiana: ' + event.details.shift_name + '\nStart: ' + (event.details.start_time | slice:0:5) + '\nKoniec: ' + (event.details.end_time | slice:0:5)">
                {{ event.details.start_time | slice:0:5 }} {{ event.details.end_time | slice:0:5 }}
              </span>
              <span *ngIf="event.type === 'freeDay'" 
                    class="tooltip" 
                    [attr.data-title]="user.first_name + '\n: ' + user.last_name + '\nData: ' + day.format('YYYY-MM-DD') + '\nUrlop'">
                🌴
              </span>
              <span *ngIf="event.type === 'weekend'" 
                    class="tooltip" 
                    [attr.data-title]="user.first_name + '\n ' + user.last_name + '\nData: ' + day.format('YYYY-MM-DD') + '\nWeekend'">
                🥂
              </span>
            </div>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- Sekcja wyświetlania błędów -->
<div *ngIf="errorMessage" class="error-message">
  {{ errorMessage }}
</div>

<div *ngIf="isLoading">
  <p>Ładowanie danych...</p>
</div>
